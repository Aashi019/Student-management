{% extends 'base.html' %}

{% block title %}My Profile - Student Portal{% endblock %}
{% block page_title %}My Profile{% endblock %}

{% block content %}
<div class="student-portal animate-fade-in-up">
    <div class="search-container" style="max-width: 600px; margin: 0 auto;">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-user-graduate"></i> Profile Lookup
                </h2>
                <p style="margin: 0.5rem 0 0 0; color: var(--text-secondary);">
                    Enter your name or student ID to view and edit your profile
                </p>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('student_search_profile') }}">
                    <div class="form-group">
                        <label class="form-label" for="search_term">
                            <i class="fas fa-search"></i> Student Name or ID
                        </label>
                        <input type="text" 
                               id="search_term" 
                               name="search_term" 
                               class="form-control" 
                               placeholder="Enter your full name or student ID (e.g., STU000001)"
                               required>
                        <small class="form-text">
                            You can search by your full name or student ID
                        </small>
                    </div>
                    <div style="text-align: center; margin-top: 1.5rem;">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i> View My Profile
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    {% if student %}
    <!-- Profile Details -->
    <div class="profile-container" style="max-width: 1000px; margin: 2rem auto 0;">
        <div class="profile-header-card">
            <div class="profile-banner"></div>
            <div class="profile-main">
                <div class="profile-avatar-large">
                    {% if student.photo_filename %}
                        <img src="{{ url_for('static', filename='uploads/' + student.photo_filename) }}" alt="{{ student.full_name }}">
                    {% else %}
                        <div class="avatar-placeholder-large">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                    {% endif %}
                </div>
                <div class="profile-info">
                    <h1>{{ student.full_name }}</h1>
                    <p class="profile-subtitle">{{ student.student_id }} â€¢ Grade {{ student.grade_level }}</p>
                    <div class="profile-badges">
                        <span class="badge badge-success"><i class="fas fa-check-circle"></i> Active</span>
                        {% if student.gpa >= 3.5 %}
                            <span class="badge badge-warning"><i class="fas fa-star"></i> Honor Roll</span>
                        {% endif %}
                    </div>
                    <div class="profile-actions" style="margin-top: 1rem;">
                        <a href="{{ url_for('student_edit_profile_with_id', student_id=student.student_id) }}" class="btn btn-primary btn-sm">
                            <i class="fas fa-edit"></i> Edit Profile
                        </a>
                        <a href="{{ url_for('student_change_password') }}" class="btn btn-secondary btn-sm">
                            <i class="fas fa-key"></i> Change Password
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-grid-2col">
            <!-- Personal Information -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-user"></i> Personal Information</h3>
                </div>
                <div class="card-body">
                    <div class="info-grid">
                        <div class="info-item">
                            <label><i class="fas fa-id-card"></i> Student ID</label>
                            <div class="info-value">{{ student.student_id }}</div>
                        </div>
                        
                        <div class="info-item">
                            <label><i class="fas fa-envelope"></i> Email</label>
                            <div class="info-value">{{ student.email }}</div>
                        </div>
                        
                        <div class="info-item">
                            <label><i class="fas fa-phone"></i> Phone</label>
                            <div class="info-value">{{ student.phone or 'Not provided' }}</div>
                        </div>
                        
                        <div class="info-item">
                            <label><i class="fas fa-birthday-cake"></i> Date of Birth</label>
                            <div class="info-value">{{ student.date_of_birth.strftime('%B %d, %Y') }} (Age {{ student.age }})</div>
                        </div>
                        
                        <div class="info-item">
                            <label><i class="fas fa-venus-mars"></i> Gender</label>
                            <div class="info-value">{{ student.gender|capitalize }}</div>
                        </div>
                        
                        <div class="info-item">
                            <label><i class="fas fa-map-marker-alt"></i> Address</label>
                            <div class="info-value">
                                {{ student.address }}<br>
                                {{ student.city }}, {{ student.state }} {{ student.zip_code }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Academic Information -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-graduation-cap"></i> Academic Information</h3>
                </div>
                <div class="card-body">
                    <div class="info-grid">
                        <div class="info-item">
                            <label><i class="fas fa-layer-group"></i> Grade Level</label>
                            <div class="info-value">{{ student.grade_level }}</div>
                        </div>
                        
                        <div class="info-item">
                            <label><i class="fas fa-chart-line"></i> GPA</label>
                            <div class="info-value">
                                <span class="gpa-badge">{{ "%.2f"|format(student.gpa) }}</span>
                            </div>
                        </div>
                        
                        <div class="info-item">
                            <label><i class="fas fa-calendar-plus"></i> Enrollment Date</label>
                            <div class="info-value">{{ student.enrollment_date.strftime('%B %d, %Y') }}</div>
                        </div>
                        
                        <div class="info-item">
                            <label><i class="fas fa-user-graduate"></i> Expected Graduation</label>
                            <div class="info-value">{{ student.graduation_year }}</div>
                        </div>
                        
                        <div class="info-item">
                            <label><i class="fas fa-calendar-check"></i> Attendance Rate</label>
                            <div class="info-value">
                                {% set attendance_rate = student.get_attendance_rate(30) %}
                                <span class="attendance-badge">{{ attendance_rate if attendance_rate is not none else 'N/A' }}%</span>
                            </div>
                        </div>
                        
                        <div class="info-item">
                            <label><i class="fas fa-info-circle"></i> Status</label>
                            <div class="info-value">
                                <span class="badge badge-success">{{ student.status|capitalize }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Contact -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-phone-volume"></i> Emergency Contact</h3>
            </div>
            <div class="card-body">
                <div class="info-grid">
                    <div class="info-item">
                        <label><i class="fas fa-user"></i> Contact Name</label>
                        <div class="info-value">{{ student.emergency_contact or 'Not provided' }}</div>
                    </div>
                    
                    <div class="info-item">
                        <label><i class="fas fa-phone"></i> Contact Phone</label>
                        <div class="info-value">{{ student.emergency_phone or 'Not provided' }}</div>
                    </div>
                    
                    <div class="info-item">
                        <label><i class="fas fa-envelope"></i> Parent Email</label>
                        <div class="info-value">{{ student.parent_email or 'Not provided' }}</div>
                    </div>
                </div>
            </div>
        </div>

        {% if student.medical_info %}
        <!-- Medical Information -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-heartbeat"></i> Medical Information</h3>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    {{ student.medical_info }}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
